{"id":"lTk1","dependencies":[{"name":"D:\\ALL LANGs\\projects\\WE-Wurks-back-end\\package.json","includedInParent":true,"mtime":1622136377773},{"name":"jsonwebtoken","loc":{"line":1,"column":20},"parent":"D:\\ALL LANGs\\projects\\WE-Wurks-back-end\\helpers.js","resolved":"D:\\ALL LANGs\\projects\\WE-Wurks-back-end\\node_modules\\jsonwebtoken\\index.js"},{"name":"./models/user","loc":{"line":2,"column":21},"parent":"D:\\ALL LANGs\\projects\\WE-Wurks-back-end\\helpers.js","resolved":"D:\\ALL LANGs\\projects\\WE-Wurks-back-end\\models\\user.js"}],"generated":{"js":"var e=require(\"jsonwebtoken\"),r=require(\"./models/user\"),n=function(n,t,o){var u=n.headers.authorization,i=u&&u.split(\" \")[1];if(!i)return t.sendStatus(401);var s=e.verify(i,\"our secret\");r.findById(s.sub).then(function(e){if(!e)return console.log(\"no matched user\");n.user=e,o()})};module.exports.handleAuthentication=n;"},"sourceMaps":{"js":{"mappings":[{"source":"helpers.js","original":{"line":1,"column":0},"generated":{"line":1,"column":0}},{"source":"helpers.js","name":"jwt","original":{"line":1,"column":6},"generated":{"line":1,"column":4}},{"source":"helpers.js","name":"require","original":{"line":1,"column":12},"generated":{"line":1,"column":6}},{"source":"helpers.js","original":{"line":1,"column":20},"generated":{"line":1,"column":14}},{"source":"helpers.js","name":"User","original":{"line":2,"column":6},"generated":{"line":1,"column":30}},{"source":"helpers.js","name":"require","original":{"line":2,"column":13},"generated":{"line":1,"column":32}},{"source":"helpers.js","original":{"line":2,"column":21},"generated":{"line":1,"column":40}},{"source":"helpers.js","name":"handleAuthentication","original":{"line":3,"column":6},"generated":{"line":1,"column":57}},{"source":"helpers.js","original":{"line":3,"column":29},"generated":{"line":1,"column":59}},{"source":"helpers.js","name":"req","original":{"line":3,"column":30},"generated":{"line":1,"column":68}},{"source":"helpers.js","name":"res","original":{"line":3,"column":35},"generated":{"line":1,"column":70}},{"source":"helpers.js","name":"next","original":{"line":3,"column":40},"generated":{"line":1,"column":72}},{"source":"helpers.js","name":"authorizeHeader","original":{"line":4,"column":8},"generated":{"line":1,"column":75}},{"source":"helpers.js","name":"authorizeHeader","original":{"line":4,"column":8},"generated":{"line":1,"column":79}},{"source":"helpers.js","name":"req","original":{"line":4,"column":26},"generated":{"line":1,"column":81}},{"source":"helpers.js","name":"headers","original":{"line":4,"column":30},"generated":{"line":1,"column":83}},{"source":"helpers.js","original":{"line":4,"column":26},"generated":{"line":1,"column":91}},{"source":"helpers.js","name":"token","original":{"line":6,"column":8},"generated":{"line":1,"column":105}},{"source":"helpers.js","name":"authorizeHeader","original":{"line":6,"column":16},"generated":{"line":1,"column":107}},{"source":"helpers.js","name":"authorizeHeader","original":{"line":6,"column":35},"generated":{"line":1,"column":110}},{"source":"helpers.js","name":"split","original":{"line":6,"column":51},"generated":{"line":1,"column":112}},{"source":"helpers.js","original":{"line":6,"column":57},"generated":{"line":1,"column":118}},{"source":"helpers.js","original":{"line":6,"column":62},"generated":{"line":1,"column":123}},{"source":"helpers.js","original":{"line":8,"column":6},"generated":{"line":1,"column":126}},{"source":"helpers.js","name":"token","original":{"line":8,"column":7},"generated":{"line":1,"column":130}},{"source":"helpers.js","original":{"line":8,"column":14},"generated":{"line":1,"column":132}},{"source":"helpers.js","name":"res","original":{"line":8,"column":21},"generated":{"line":1,"column":139}},{"source":"helpers.js","name":"sendStatus","original":{"line":8,"column":25},"generated":{"line":1,"column":141}},{"source":"helpers.js","original":{"line":8,"column":36},"generated":{"line":1,"column":152}},{"source":"helpers.js","name":"payload","original":{"line":10,"column":8},"generated":{"line":1,"column":157}},{"source":"helpers.js","name":"payload","original":{"line":10,"column":8},"generated":{"line":1,"column":161}},{"source":"helpers.js","name":"jwt","original":{"line":10,"column":18},"generated":{"line":1,"column":163}},{"source":"helpers.js","name":"verify","original":{"line":10,"column":22},"generated":{"line":1,"column":165}},{"source":"helpers.js","name":"token","original":{"line":10,"column":29},"generated":{"line":1,"column":172}},{"source":"helpers.js","original":{"line":10,"column":36},"generated":{"line":1,"column":174}},{"source":"helpers.js","name":"User","original":{"line":12,"column":2},"generated":{"line":1,"column":188}},{"source":"helpers.js","name":"findById","original":{"line":12,"column":7},"generated":{"line":1,"column":190}},{"source":"helpers.js","name":"payload","original":{"line":12,"column":16},"generated":{"line":1,"column":199}},{"source":"helpers.js","name":"sub","original":{"line":12,"column":24},"generated":{"line":1,"column":201}},{"source":"helpers.js","name":"then","original":{"line":12,"column":29},"generated":{"line":1,"column":206}},{"source":"helpers.js","original":{"line":12,"column":34},"generated":{"line":1,"column":211}},{"source":"helpers.js","name":"user","original":{"line":12,"column":35},"generated":{"line":1,"column":220}},{"source":"helpers.js","original":{"line":13,"column":8},"generated":{"line":1,"column":223}},{"source":"helpers.js","name":"user","original":{"line":13,"column":9},"generated":{"line":1,"column":227}},{"source":"helpers.js","original":{"line":13,"column":15},"generated":{"line":1,"column":229}},{"source":"helpers.js","name":"console","original":{"line":13,"column":22},"generated":{"line":1,"column":236}},{"source":"helpers.js","name":"log","original":{"line":13,"column":30},"generated":{"line":1,"column":244}},{"source":"helpers.js","original":{"line":13,"column":34},"generated":{"line":1,"column":248}},{"source":"helpers.js","name":"req","original":{"line":14,"column":4},"generated":{"line":1,"column":267}},{"source":"helpers.js","name":"user","original":{"line":14,"column":8},"generated":{"line":1,"column":269}},{"source":"helpers.js","name":"user","original":{"line":14,"column":15},"generated":{"line":1,"column":274}},{"source":"helpers.js","name":"next","original":{"line":15,"column":4},"generated":{"line":1,"column":276}},{"source":"helpers.js","name":"module","original":{"line":19,"column":0},"generated":{"line":1,"column":283}},{"source":"helpers.js","name":"exports","original":{"line":19,"column":7},"generated":{"line":1,"column":290}},{"source":"helpers.js","name":"handleAuthentication","original":{"line":19,"column":15},"generated":{"line":1,"column":298}},{"source":"helpers.js","name":"handleAuthentication","original":{"line":19,"column":38},"generated":{"line":1,"column":319}}],"sources":{"helpers.js":"const jwt = require('jsonwebtoken')\r\nconst User = require('./models/user')\r\nconst handleAuthentication = (req, res, next) => {\r\n  const authorizeHeader = req.headers[\"authorization\"];\r\n\r\n  const token = authorizeHeader && authorizeHeader.split(\" \")[1];\r\n\r\n  if (!token) return res.sendStatus(401);\r\n\r\n  const payload = jwt.verify(token, \"our secret\");\r\n\r\n  User.findById(payload.sub).then((user) => {\r\n    if (!user) return console.log(\"no matched user\");\r\n    req.user = user;\r\n    next();\r\n  });\r\n};\r\n\r\nmodule.exports.handleAuthentication = handleAuthentication; \r\n\r\n// get your token\r\n\r\n// we will assume that authorize header is in that shape \"authorization:Bearer AToken\"\r\n// now check if there is a token or not\r\n// verify it and get your payload\r\n// this verify function verify that the hashed header and the hashed body matches their hashed signature\r\n\r\n// authenticate the user\r\n"},"lineCount":null}},"error":null,"hash":"1fc762353220434230031b4e27aeb21d","cacheData":{"env":{}}}